---
title: "4.2.1 ワークロードの作成"
excerpt: ""
permalink: /docs/ja/4.2.1/
redirect_from:
  - /theme-setup/
toc: false
toc_sticky: false
sidebar:
  nav: "ja"
---

---
グループ管理で、ワークロードを作成して実行する。

### a\) 左側のメインメニュー → サービス → サービスカード選択 → ワークロードグループの＋ボタン（ワークロード作成）をクリック。
![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_1.png)

![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_2.png)
ワークロードタイプを選択する。
![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_3.png)

### b\) 基本情報、 初期化コンテナ、コンテナ、 インスタンス、Auto-Scale、 アップデートポリシー、 サービスポート、 ボリュームマウント、ボリューム、ボリュームテンプレート内容を作成して作成ボタンを押してワークロードを作成。
![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_4.png)

* **ワークロード基本情報の設定**
![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_5.png)

| **項目** | **説明** |
| :--- | :--- |
| 名前 | 作成するワークロード名 |
| グループ | ワークロードが作成されるワークロードグループ |
| タイプ | ワークロードのインスタンスタイプ（Single/Multi）|
| 説明 | ワークロードの説明 |

* **InitContainer 作成**
  * **コンテナと同一だが、コンテナより先に実行されるコンテナ**
  * 初期化コンテナの右側の「＋ボタン」をクリック。
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_6.png)
  * コンテナ名を入力し、 コンテナとして使用するイメージのビルドやイメージから選択し、使用するCPU/Memoryリソース値を定義する。（GPUで生成する場合、GPU値も設定する。）
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_7.png)
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_8.png)
  * コンテナが作成され、使用するコマンドを入力することができる。
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_9.png)
  * コンテナの環境変数の値を入力するか、 Secretを選択して設定することができる。
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_10.png)  
  * セキュリティポリシーを設定することができる。
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_11.png)
  * コンテナのヘルスチェックを設定することができる。（Readiness Probeは設定しない）
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_12.png)
  * コンテナのLifeCycle Hookを設定することができる。
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_13.png)

  * **コンテナ作成**

    * コンテナの右側の「＋ボタン」をクリック。
    ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_14.png)
    * コンテナ名を入力し、 コンテナとして使用するイメージのビルドやイメージから選択し、使用するCPU/Memoryリソース値を定義する。（GPUで生成する場合、GPU値も設定する。）
    ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_15.png)
    ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_16.png)
    * コンテナが作成され、使用するコマンドを入力することができる。
    ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_17.png)
    * コンテナの環境変数の値を入力するか、 Secretを選択して設定することができる。
    ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_18.png)  
    * セキュリティポリシーを設定することができる。
    ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_19.png)
    * コンテナのヘルスチェックを設定することができる。
    ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_20.png)
    * コンテナのLifeCycle Hookを設定することができる。
    ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_21.png)

* **インスタンス**

  * **インスタンス項目の「✎ボタン」をクリック**
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_22.png)
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_23.png)

| **項目** | **説明** |
| :--- | :--- |
| レプリカ | 基本インスタンス数（Daemon/Job/CronJobタイプは特に設定なし） |
| ホスト名 | 名称 |
| 終了時猶予時間（秒） | 終了時猶予時間 |
| 準備後待機時間（秒） | 準備後待機時間 |
| ノードラベルKEY | ノードラベルKEY値 |
| ノードラベル値 | ノードラベル値 |
| アクセス権限（RBAC services Account） | アクセス権限 RBAC 値 |

* **サーバータイプがDaemonSetの場合**
![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_24.png)

* **サーバータイプがCronJobの場合に該当**
![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_25.png)

| **項目** | **説明** |
| :--- | :--- |
| 同時実行ポリシー | Allow: 同時Jobを許容、 Forbid: 同時Jobを禁じ、先行Jobが終わってない場合は、次のJobを省く、 Replace: 現在実行中のJobをキャンセルし、新しい項目に変える。|
| スケジュール | スケジュール（schedule） |
| 期限指定（秒） | 期限指定（Specify the due date） |
| 成功Job履歴制限 | 成功Job履歴（Successful Job History Limitations） |
| 失敗Job履歴制限 | 失敗Job履歴（Failed Job History Limitations） |
| 後続実行の一時停止 | Job履歴（Suspend） |

* **サーバータイプがJob/CronJobの場合**
![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_26.png)

| **項目** | **説明** |
| :--- | :--- |
| Job完了回数 | Job完了回数（Completions）|
| 同時ロード | 同時ロード。0の場合、値が増加するまでJobが一時中止される（Parallelism） |
| 活性期限（秒） | 活性期限（Active Deadline Seconds） |
| Back off Limit | backoffLimit |
| 終了後削除待機時間（秒） | TTL Seconds After Finished |
| 後続実行の一時停止 | Job履歴（Suspend） |

* **サーバータイプがStatefulの場合**
![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_27.png)

| **項目** | **説明** |
| :--- | :--- |
| インスタンス管理ポリシー | OrderedReady/Parallel（Pod Management Policy）|

* **Auto-Scale（サーバータイプがMultiの場合）**

  * **Auto－Scale の項目の 「✎ ボタン」をクリック**  
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_28.png)
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_29.png)

| **項目** | **説明** |
| :--- | :--- |
| CPU 使用率（パーセンテージ） | オートスケーリングの基準（使用率） |
| メモリ 使用率（パーセンテージ） | オートスケーリングの基準（使用率） |
| 最大レプリカ数 | スケーリング時のインスタンス最大値 |

* **アップデートポリシー（サーバータイプがMulti/Stateful/Daemonの場合）**

  * **アップデートポリシー項目の「✎ボタン」をクリック**
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_30.png)
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_31.png)
  ![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_32.png)

  * **Stateful/Daemonの場合、ポリシーはRolling Updateのみ選択可能**

| **項目** | **説明** |
| :--- | :--- |
| アップデートポリシー | Rolling Update/ Recreateで定義。 Rolling Updateで中止Podと拡張Podを定義し、リソースの効率性を向上する無中止アップデートが可能、Recreateでは1回でアップデート可能。 |
| レプリカ数比べ中止比率(%) | Rolling Updateの場合、中止されるPod比率（Statefulタイプの場合、設定なし） |
| レプリカ数比べ拡張比率(%) | Rolling Updateの場合、拡張されるPod比率（Stateful/Daemonタイプの場合、設定なし） |
| パーティション | Statefulタイプの場合のみ選択。該当パーティションより大きい場合、または同一のバージョンはすべてのPodがアップデートされる。パーティションより低いバージョンのPodはアップデートせず、削除されても以前バージョンで再度作成される。 |

*  **サービスポート**
* **Stateful/Daemonの場合、Headlessタイプでセットされる。**
* **Job/CronJobの場合、設定しない。**
![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_33.png)
![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_34.png)

* ワークロード内でポート連携の場合、Internalタイプのみ利用可能。

| **項目** | **説明** |
| :--- | :--- |
| Internal | コンテナの内部通信ネットワーク |
| Sticky Session | 特定のクライアントの要求でセッションを維持するオプション |
| タイムアウト（秒） | Sticky Session維持時間 |

| **項目** | **説明** |
| :--- | :--- |
| 名前 | ポート名を定義 |
| プロトコル | TCP、UDP |
| ターゲットポート | コンテナポートを定義 |
| サービスポート | 外部ポートを定義 |

* **ボリューム**

![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_35.png)
![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_36.png)

| **項目** | 説明 |
| :--- | :--- |
| ボリューム | サーバーで使用するボリュームを作成 |
| ボリュームマウント | 作成されたボリュームにサーバーをマウント |
| Persistent Volume Mount | 作成されたPersistent Volumeにワークロードをマウント |

| **ボリュームの種類** | **説明** |
| :--- | :--- |
| Empty Dir | コンテナ内に一時的にディレクトリボリューム |
| Host Path | コンテナが配置されているクラスターサーバーのボリューム |
| Config Map | ワークロードに登録されているConfig Fileを使用 |
| Secret | ワークロードに登録されている Secret Fileを使用 （権限使用有無の設定が可能で、 CHMODルールを使用。 未使用時のDefault権限は644） |


* **ボリュームマウント**

![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_37.png)
![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_38.png)

* コンテナが追加されるとボタンが有効化になる。

* **ボリュームテンプレート**
* **サーバータイプがStatefulのみ登録可能**

![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_39.png)
![]({{ site.baseurl }}/assets/EN/{{ site.version }}/4.2.1_40.png)

|   **項目**    | **説明**                                                                           |
| :---------: | :------------------------------------------------------------------------------- |
| ストレージボリュームタイプ | ボリュームタイプ(Single, Shared)                                                            |
| ストレージ     | クラスターに登録されたストレージリスト公開                                                         |
| アクセスモード    | ストレージボリュームタイプがSingleの場合はReadWriteOnce、Shardの場合はReadWriteMany、ReadOnlyManyを選択 |
| ボリューム名      | 作成するストレージボリューム名                                                                 |
| サイズ   | 作成するストレージボリュームのサイズ（GB）             |
